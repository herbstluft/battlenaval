<app-navbar></app-navbar>

<div class="container-fluid min-vh-100 py-5" style="background: linear-gradient(135deg, #1a2a6c, #2a4858, #141E30)">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12">
        <!-- Header Section with Animation -->
        <div class="text-center mb-5 animate__animated animate__fadeIn">
          <h2 class="display-4 text-white mb-3" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">
            <i class="fas fa-history me-3"></i>Historial de Batallas
          </h2>
          <p class="text-light lead">Registro de tus batallas navales</p>
        </div>

        <!-- Main Card -->
        <div class="card border-0 shadow-lg" style="backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.1); border-radius: 15px;">
          <div class="card-body p-4">
            <!-- Loading Spinner -->
            <div *ngIf="loading" class="text-center py-5">
              <div class="spinner-border text-light" role="status" style="width: 3rem; height: 3rem;">
                <span class="visually-hidden">Cargando...</span>
              </div>
            </div>

            <!-- Error Message -->
            <div *ngIf="error" class="alert alert-danger animate__animated animate__fadeIn">
              <i class="fas fa-exclamation-circle me-2"></i>{{ error }}
            </div>

            <!-- Game History Table -->
            <div *ngIf="!loading && !error" class="table-responsive animate__animated animate__fadeIn">
              <table class="table table-hover">
                <thead>
                  <tr class="text-white-50 text-uppercase" style="border-bottom: 2px solid rgba(255,255,255,0.1)">
                    <th class="py-3">Fecha</th>
                    <th class="py-3">Estado</th>
                    <th class="py-3">Resultado</th>
                    <th class="py-3">Movimientos</th>
                    <th class="py-3">Precisión</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let game of gameHistory" class="text-white" style="border-bottom: 1px solid rgba(255,255,255,0.05)">
                    <td class="py-3">
                      <i class="far fa-calendar-alt me-2"></i>
                      {{ game.date | date:'dd/MM/yyyy HH:mm' }}
                    </td>
                    <td class="py-3">
                      <span class="badge" [ngClass]="{
                        'bg-success': game.status === 'finished',
                        'bg-warning': game.status === 'in_progress',
                        'bg-secondary': game.status === 'abandoned'
                      }">{{ game.status }}</span>
                    </td>
                    <td class="py-3">
                      <span [ngClass]="{
                        'text-success': game.winner_id === currentUserId,
                        'text-danger': game.winner_id !== currentUserId
                      }">
                        <i class="fas" [ngClass]="{
                          'fa-trophy': game.winner_id === currentUserId,
                          'fa-times-circle': game.winner_id !== currentUserId
                        }"></i>
                        {{ game.winner_id === currentUserId ? ' Victoria' : ' Derrota' }}
                      </span>
                    </td>
                    <td class="py-3">
                      <i class="fas fa-crosshairs me-2"></i>
                      {{ game.total_moves }}
                    </td>
                    <td class="py-3">
                      <div class="progress" style="height: 20px; background: rgba(255,255,255,0.1);">
                        <div class="progress-bar" 
                             [ngClass]="{
                               'bg-success': game.accuracy >= 70,
                               'bg-warning': game.accuracy >= 40 && game.accuracy < 70,
                               'bg-danger': game.accuracy < 40
                             }"
                             [style.width.%]="game.accuracy">
                          {{ game.accuracy }}%
                        </div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- No Games Message -->
            <div *ngIf="!loading && !error && gameHistory.length === 0" class="text-center py-5 text-white-50">
              <i class="fas fa-ship fa-3x mb-3"></i>
              <h4>No hay batallas registradas</h4>
              <p>¡Comienza tu primera batalla naval!</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>